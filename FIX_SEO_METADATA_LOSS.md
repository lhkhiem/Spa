# Sửa lỗi SEO trang tĩnh bị xóa

## Vấn đề
Khi duplicate/update product, SEO metadata của các trang tĩnh bị xóa sạch.

## Nguyên nhân
Logic filter static pages trong `syncProductMetadataToCMS` có thể:
1. Quá strict - chỉ giữ pages có điều kiện chính xác
2. Không xử lý edge cases (pages không có flag autoGenerated)
3. Race condition khi nhiều products sync cùng lúc

## Đã sửa

### 1. Cải thiện logic filter
- ✅ Kiểm tra kỹ hơn: `p && p.path` trước khi filter
- ✅ Chỉ filter out auto-generated product pages (`autoGenerated === true && path.startsWith('/products/')`)
- ✅ Giữ TẤT CẢ các pages khác (static, custom, posts, categories, etc.)

### 2. Thêm validation
- ✅ Kiểm tra số lượng static pages trước và sau
- ✅ Throw error nếu mất static pages (safety check)
- ✅ Log chi tiết để debug

### 3. Logging tốt hơn
- ✅ Log số lượng static pages được preserve
- ✅ Log số lượng product pages
- ✅ Warning nếu có vấn đề

## Build lại
```bash
cd /var/www/Spa/CMS/backend
npm run build
pm2 restart cms-backend
```

## Kiểm tra
1. Kiểm tra SEO settings trước khi test:
   ```sql
   SELECT value FROM settings WHERE namespace = 'seo';
   ```

2. Test duplicate/update product

3. Kiểm tra lại SEO settings - static pages phải còn nguyên:
   ```sql
   SELECT value FROM settings WHERE namespace = 'seo';
   ```

## Kết quả mong đợi
- ✅ Static pages không bị xóa
- ✅ Chỉ update/merge product pages
- ✅ Error nếu có risk mất data
- ✅ Logs chi tiết để debug
