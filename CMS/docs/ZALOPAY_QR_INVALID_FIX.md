# HÆ°á»›ng dáº«n xá»­ lÃ½ lá»—i "QR khÃ´ng há»£p lá»‡" vá»›i ZaloPay Sandbox

## ğŸ” Váº¥n Ä‘á»

Khi quÃ©t QR code tá»« ZaloPay Sandbox báº±ng app ZaloPay production, báº¡n cÃ³ thá»ƒ gáº·p lá»—i **"QR khÃ´ng há»£p lá»‡"** hoáº·c **"ChÆ°a thá»ƒ káº¿t ná»‘i Ä‘áº¿n há»‡ thá»‘ng"**.

## âœ… NguyÃªn nhÃ¢n

**ZaloPay Sandbox QR code KHÃ”NG thá»ƒ quÃ©t báº±ng app ZaloPay production!**

- ZaloPay Sandbox sá»­ dá»¥ng mÃ´i trÆ°á»ng test riÃªng biá»‡t
- QR code tá»« Sandbox chá»‰ cÃ³ thá»ƒ quÃ©t báº±ng:
  - **App ZaloPay Sandbox** (app riÃªng cho test)
  - Hoáº·c **ZaloPay Web Sandbox** (trÃªn trÃ¬nh duyá»‡t)

## ğŸ“± Táº£i ZaloPay Sandbox App

### CÃ¡ch táº£i ZaloPay Sandbox App:

1. **Truy cáº­p trang Downloads:**
   - Link: https://developers.zalopay.vn/downloads/
   - Hoáº·c vÃ o ZaloPay Developer Portal â†’ Downloads

2. **Táº£i app theo há»‡ Ä‘iá»u hÃ nh:**

   **Android:**
   - TÃ¬m má»¥c "á»¨ng dá»¥ng ZaloPay Sandbox"
   - Nháº¥n "Download" cho Android
   - CÃ i Ä‘áº·t file APK

   **iOS:**
   - TÃ¬m má»¥c "á»¨ng dá»¥ng ZaloPay Sandbox"
   - Nháº¥n "Download" cho iOS
   - Sau khi cÃ i Ä‘áº·t, cáº§n thiáº¿t láº­p tin tÆ°á»Ÿng:
     - VÃ o **CÃ i Ä‘áº·t** â†’ **CÃ i Ä‘áº·t chung** â†’ **Quáº£n lÃ½ thiáº¿t bá»‹**
     - TÃ¬m **ZION COMPANY LIMITED** â†’ **Tin cáº­y ZION COMPANY LIMITED**

3. **ÄÄƒng nháº­p:**
   - DÃ¹ng tÃ i khoáº£n Zalo Ä‘Ã£ Ä‘Äƒng kÃ½ vá»›i ZaloPay Developer
   - Sau khi Ä‘Äƒng nháº­p, cáº§n Ä‘á»‹nh danh (KYC) trÃªn app Ä‘á»ƒ sá»­ dá»¥ng thanh toÃ¡n test

### LÆ°u Ã½:
- App ZaloPay Sandbox lÃ  app riÃªng, khÃ¡c vá»›i app ZaloPay production
- Pháº£i dÃ¹ng app Sandbox Ä‘á»ƒ quÃ©t QR code tá»« Sandbox
- TÃ i khoáº£n Ä‘Äƒng nháº­p pháº£i lÃ  tÃ i khoáº£n Ä‘Ã£ Ä‘Äƒng kÃ½ vá»›i ZaloPay Developer

## ğŸ”§ Giáº£i phÃ¡p

### CÃ¡ch 1: DÃ¹ng App ZaloPay Sandbox (Khuyáº¿n nghá»‹)

1. **Táº£i vÃ  cÃ i Ä‘áº·t app ZaloPay Sandbox:**
   - Link: https://developers.zalopay.vn/downloads/
   - CÃ i Ä‘áº·t theo hÆ°á»›ng dáº«n á»Ÿ trÃªn

2. **ÄÄƒng nháº­p vÃ  Ä‘á»‹nh danh:**
   - ÄÄƒng nháº­p báº±ng tÃ i khoáº£n Zalo Ä‘Ã£ Ä‘Äƒng kÃ½ vá»›i ZaloPay Developer
   - Thá»±c hiá»‡n Ä‘á»‹nh danh (KYC) trÃªn app

3. **Test thanh toÃ¡n:**
   - Khi táº¡o Ä‘Æ¡n hÃ ng vá»›i ZaloPay, báº¡n sáº½ Ä‘Æ°á»£c redirect Ä‘áº¿n `order_url`
   - TrÃªn trang ZaloPay Sandbox, QR code sáº½ hiá»ƒn thá»‹
   - **Má»Ÿ app ZaloPay Sandbox** (KHÃ”NG pháº£i app production)
   - QuÃ©t QR code báº±ng app Sandbox
   - XÃ¡c nháº­n thanh toÃ¡n trong app

### CÃ¡ch 2: Test trÃªn ZaloPay Web Sandbox (Náº¿u khÃ´ng cÃ³ app)

1. Khi táº¡o Ä‘Æ¡n hÃ ng vá»›i ZaloPay, báº¡n sáº½ Ä‘Æ°á»£c redirect Ä‘áº¿n `order_url`
2. TrÃªn trang ZaloPay Sandbox, QR code sáº½ hiá»ƒn thá»‹
3. **KHÃ”NG quÃ©t QR code báº±ng app ZaloPay production**
4. Thay vÃ o Ä‘Ã³, sá»­ dá»¥ng **ZaloPay Web Sandbox** Ä‘á»ƒ test:
   - ÄÄƒng nháº­p vÃ o ZaloPay Sandbox Dashboard
   - VÃ o pháº§n "Test Payment" hoáº·c "Sandbox Testing"
   - Nháº­p thÃ´ng tin giao dá»‹ch Ä‘á»ƒ test

### CÃ¡ch 2: Sá»­ dá»¥ng ZaloPay Production (Sau khi test xong)

Sau khi test thÃ nh cÃ´ng vá»›i Sandbox, chuyá»ƒn sang ZaloPay Production:

1. **Cáº­p nháº­t `.env`** vá»›i credentials Production:
   ```bash
   ZP_APP_ID=<production_app_id>
   ZP_KEY1=<production_key1>
   ZP_CALLBACK_KEY=<production_key2>
   ZP_API_BASE=https://openapi.zalopay.vn/v2  # Production API
   ```

2. **Restart backend**:
   ```bash
   pm2 restart cms-backend
   ```

3. **Test láº¡i** vá»›i QR code tá»« Production - lÃºc nÃ y cÃ³ thá»ƒ quÃ©t báº±ng app ZaloPay production

## ğŸ“ LÆ°u Ã½ quan trá»ng

1. **Sandbox QR code â‰  Production QR code**
   - Sandbox: Chá»‰ test, khÃ´ng thá»ƒ quÃ©t báº±ng app production
   - Production: CÃ³ thá»ƒ quÃ©t báº±ng app ZaloPay tháº­t

2. **Callback URL**
   - Sandbox: CÃ³ thá»ƒ dÃ¹ng ngrok hoáº·c public URL
   - Production: Pháº£i lÃ  HTTPS vÃ  accessible tá»« ZaloPay servers

3. **Test Flow**
   - âœ… Test táº¡o order â†’ Kiá»ƒm tra `order_url` cÃ³ Ä‘Æ°á»£c tráº£ vá»
   - âœ… Test redirect â†’ Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ trÃªn trang ZaloPay
   - âœ… Test callback â†’ Kiá»ƒm tra callback cÃ³ Ä‘Æ°á»£c nháº­n (dÃ¹ng ngrok náº¿u local)
   - âŒ KHÃ”NG test quÃ©t QR báº±ng app production khi dÃ¹ng Sandbox

## ğŸ¯ Káº¿t luáº­n

**Lá»—i "QR khÃ´ng há»£p lá»‡" khi quÃ©t Sandbox QR code báº±ng app ZaloPay production lÃ  BÃŒNH THÆ¯á»œNG!**

- ÄÃ¢y khÃ´ng pháº£i lá»—i code
- ÄÃ¢y lÃ  háº¡n cháº¿ cá»§a ZaloPay Sandbox
- Äá»ƒ test Ä‘áº§y Ä‘á»§, cáº§n:
  1. Test vá»›i Sandbox (khÃ´ng quÃ©t QR)
  2. Hoáº·c chuyá»ƒn sang Production Ä‘á»ƒ test quÃ©t QR tháº­t

---

**TÃ i liá»‡u liÃªn quan:**
- [ZaloPay Integration Guide](./ZALOPAY_INTEGRATION.md)
- [ZaloPay Setup Guide](./ZALOPAY_SETUP_GUIDE.md)
- [ZaloPay Test Guide](./ZALOPAY_TEST_GUIDE.md)

